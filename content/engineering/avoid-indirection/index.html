
<!DOCTYPE html>

<html>
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="generator" content="Docutils 0.17.1: http://docutils.sourceforge.net/" />

<meta property="og:title" content="Avoid Indirection" />
  
<meta property="og:type" content="website" />
  
<meta property="og:url" content="content/engineering/avoid-indirection/" />
  
<meta property="og:description" content="This post argues for avoiding indirection in community code. We are taught to hide away details: I often see code where authors abstract away details by placing them in some external function. Here..." />
  
    <title>Avoid Indirection &#8212; Matthew Rocklin</title>
<script>
  document.documentElement.dataset.mode = localStorage.getItem("mode") || "";
  document.documentElement.dataset.theme = localStorage.getItem("theme") || "light"
</script>

  <!-- Loaded before other Sphinx assets -->
  <link href="../../../_static/styles/theme.css?digest=92025949c220c2e29695" rel="stylesheet">
<link href="../../../_static/styles/pydata-sphinx-theme.css?digest=92025949c220c2e29695" rel="stylesheet">


  <link rel="stylesheet"
    href="../../../_static/vendor/fontawesome/5.13.0/css/all.min.css">
  <link rel="preload" as="font" type="font/woff2" crossorigin
    href="../../../_static/vendor/fontawesome/5.13.0/webfonts/fa-solid-900.woff2">
  <link rel="preload" as="font" type="font/woff2" crossorigin
    href="../../../_static/vendor/fontawesome/5.13.0/webfonts/fa-brands-400.woff2">

    <link rel="stylesheet" type="text/css" href="../../../_static/pygments.css" />
    <link rel="stylesheet" type="text/css" href="../../../_static/mystnb.css" />
    <link rel="stylesheet" type="text/css" href="../../../_static/togglebutton.css" />
    <link rel="stylesheet" type="text/css" href="../../../_static/custom.css" />
    <link rel="stylesheet" type="text/css" href="../../../_static/panels-main.c949a650a448cc0ae9fd3441c0e17fb0.css" />
    <link rel="stylesheet" type="text/css" href="../../../_static/panels-variables.06eb56fa6e07937060861dad626602ad.css" />

  <!-- Pre-loaded scripts that we'll load fully later -->
  <link rel="preload" as="script" href="../../../_static/scripts/pydata-sphinx-theme.js?digest=92025949c220c2e29695">

    <script data-url_root="../../../" id="documentation_options" src="../../../_static/documentation_options.js"></script>
    <script src="../../../_static/jquery.js"></script>
    <script src="../../../_static/underscore.js"></script>
    <script src="../../../_static/doctools.js"></script>
    <script>let toggleHintShow = 'Click to show';</script>
    <script>let toggleHintHide = 'Click to hide';</script>
    <script>let toggleOpenOnPrint = 'true';</script>
    <script src="../../../_static/togglebutton.js"></script>
    <script>var togglebuttonSelector = '.toggle, .admonition.dropdown, .tag_hide_input div.cell_input, .tag_hide-input div.cell_input, .tag_hide_output div.cell_output, .tag_hide-output div.cell_output, .tag_hide_cell.cell, .tag_hide-cell.cell';</script>
    <link rel="shortcut icon" href="../../../_static/favicon.ico"/>
    <link rel="index" title="Index" href="../../../genindex/" />
    <link rel="search" title="Search" href="../../../search/" />
    <link rel="next" title="Biased Benchmarks" href="../biased-benchmarks/" />
    <link rel="prev" title="Writings" href="../../" /> 
<meta name="viewport" content="width=device-width, initial-scale=1" />
<meta name="docsearch:language" content="None"> 
<link
  rel="alternate"
  type="application/atom+xml"
  href="../../../blog/atom.xml"
  title="Working Notes"
/>
 
<style type="text/css">
  ul.ablog-archive {
    list-style: none;
    overflow: auto;
    margin-left: 0px;
  }
  ul.ablog-archive li {
    float: left;
    margin-right: 5px;
    font-size: 80%;
  }
  ul.postlist a {
    font-style: italic;
  }
  ul.postlist-style-disc {
    list-style-type: disc;
  }
  ul.postlist-style-none {
    list-style-type: none;
  }
  ul.postlist-style-circle {
    list-style-type: circle;
  }
</style>

  </head>
  
  
  <body data-spy="scroll" data-target="#bd-toc-nav" data-offset="180" data-default-mode="">
    <div class="bd-header-announcement container-fluid" id="banner">
      

    </div>

    
    <nav class="bd-header navbar navbar-light navbar-expand-lg bg-light fixed-top bd-navbar" id="navbar-main"><div class="bd-header__inner container-xl">

  <div id="navbar-start">
    
    
  


<a class="navbar-brand logo" href="../../../">
  
  
  
  
  
    <p class="title logo__title">Matthew Rocklin</p>
  
</a>
    
  </div>

  <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbar-collapsible" aria-controls="navbar-collapsible" aria-expanded="false" aria-label="Toggle navigation">
    <span class="fas fa-bars"></span>
  </button>

  
  <div id="navbar-collapsible" class="col-lg-9 collapse navbar-collapse">
    <div id="navbar-center" class="mr-auto">
      
      <div class="navbar-center-item">
        <ul id="navbar-main-elements" class="navbar-nav">
    <li class="toctree-l1 current active nav-item">
 <a class="reference internal nav-link" href="../../">
  Writings
 </a>
</li>

<li class="toctree-l1 nav-item">
 <a class="reference external nav-link" href="https://matthewrocklin.com/blog">
  Old Blog
 </a>
</li>

    
</ul>
      </div>
      
    </div>

    <div id="navbar-end">
      
      <div class="navbar-end-item">
        <form class="bd-search d-flex align-items-center" action="../../../search/" method="get">
  <i class="icon fas fa-search"></i>
  <input type="search" class="form-control" name="q" id="search-input" placeholder="Search ..." aria-label="Search ..." autocomplete="off" >
</form>
      </div>
      
      <div class="navbar-end-item">
        <span id="theme-switch" class="btn btn-sm btn-outline-primary navbar-btn rounded-circle">
    <a class="theme-switch" data-mode="light"><i class="fas fa-sun"></i></a>
    <a class="theme-switch" data-mode="dark"><i class="far fa-moon"></i></a>
    <a class="theme-switch" data-mode="auto"><i class="fas fa-adjust"></i></a>
</span>
      </div>
      
      <div class="navbar-end-item">
        <ul id="navbar-icon-links" class="navbar-nav" aria-label="Icon Links">
        <li class="nav-item">
          <a class="nav-link" href="https://github.com/mrocklin/" rel="noopener" target="_blank" title="GitHub"><span><i class="fab fa-github-square"></i></span>
            <label class="sr-only">GitHub</label></a>
        </li>
        <li class="nav-item">
          <a class="nav-link" href="https://twitter.com/mrocklin" rel="noopener" target="_blank" title="Twitter"><span><i class="fab fa-twitter-square"></i></span>
            <label class="sr-only">Twitter</label></a>
        </li>
      </ul>
      </div>
      
    </div>
  </div>
</div>
    </nav>
    

    <div class="bd-container container-xl">
      <div class="bd-container__inner row">
          

<!-- Only show if we have sidebars configured, else just a small margin  -->
<div class="bd-sidebar-primary col-12 col-md-3 bd-sidebar">
  <div class="sidebar-start-items"><form class="bd-search d-flex align-items-center" action="../../../search/" method="get">
  <i class="icon fas fa-search"></i>
  <input type="search" class="form-control" name="q" id="search-input" placeholder="Search ..." aria-label="Search ..." autocomplete="off" >
</form><nav class="bd-links" id="bd-docs-nav" aria-label="Main navigation">
  <div class="bd-toc-item active">
    <p class="caption" role="heading">
 <span class="caption-text">
  Engineering
 </span>
</p>
<ul class="current nav bd-sidenav">
 <li class="toctree-l1 current active">
  <a class="current reference internal" href="#">
   Avoid Indirection
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../biased-benchmarks/">
   Biased Benchmarks
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../engineers-and-sales/">
   Listen to Sell
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../fast-review/">
   Small Scope Reviews
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../maintainer/">
   Maintainers
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../minimal-bug-reports/">
   Craft Minimal Bug Reports
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../scipy-mission/">
   SciPy Mission
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../senior-engineer/">
   Senior Engineers
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../shared-abstractions/">
   Dictionaries v. Objects
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../slack-github/">
   Why I Avoid Slack
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../technical-lead/">
   Tech Leads
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../write-dumb-code/">
   Write Dumb Code
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../write-tests/">
   Write Tests
  </a>
 </li>
</ul>
<p class="caption" role="heading">
 <span class="caption-text">
  Startups
 </span>
</p>
<ul class="nav bd-sidenav">
 <li class="toctree-l1">
  <a class="reference internal" href="../../startups/over-grown/">
   Over Grown
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../startups/scimitar-growth/">
   Bad Metrics
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../startups/startup-revenue/">
   Revenue Types
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../startups/support/">
   Enterprise Support
  </a>
 </li>
</ul>
<p class="caption" role="heading">
 <span class="caption-text">
  Writing
 </span>
</p>
<ul class="nav bd-sidenav">
 <li class="toctree-l1">
  <a class="reference internal" href="../../writing/brevity/">
   Short Attention Span
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../writing/tweet/">
   Ideal Tweet
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../writing/write-short-blogposts/">
   Short Blogposts
  </a>
 </li>
</ul>

  </div>
</nav>
  </div>
  <div class="sidebar-end-items">
  </div>
</div>


          


<div class="bd-sidebar-secondary d-none d-xl-block col-xl-2 bd-toc">
  
    
  
</div>


          
          
          <div class="bd-content col-12 col-md-9 col-xl-7">
              

              <article class="bd-article" role="main">
                 <section id="avoid-indirection">
<h1>Avoid Indirection<a class="headerlink" href="#avoid-indirection" title="Permalink to this headline">#</a></h1>
<p>This post argues for avoiding indirection in community code.</p>
<section id="we-are-taught-to-hide-away-details">
<h2>We are taught to hide away details<a class="headerlink" href="#we-are-taught-to-hide-away-details" title="Permalink to this headline">#</a></h2>
<p>I often see code where authors abstract away details by placing them in some
external function.  Here is a toy example:</p>
<section id="before-indirection">
<h3>Before indirection<a class="headerlink" href="#before-indirection" title="Permalink to this headline">#</a></h3>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># main.py</span>

<span class="k">if</span> <span class="n">x</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s2">&quot;foo&quot;</span><span class="p">):</span>
    <span class="n">do_something_with</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
</pre></div>
</div>
</section>
<section id="after-indirection">
<h3>After indirection<a class="headerlink" href="#after-indirection" title="Permalink to this headline">#</a></h3>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># main.py</span>

<span class="k">if</span> <span class="n">is_foolike</span><span class="p">(</span><span class="n">x</span><span class="p">):</span>
    <span class="n">do_something_with</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
</pre></div>
</div>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># utils.py</span>

<span class="k">def</span> <span class="nf">is_foolike</span><span class="p">(</span><span class="n">x</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">x</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s2">&quot;foo&quot;</span><span class="p">)</span>
</pre></div>
</div>
<p>There are good reasons for this behavior:</p>
<ol class="arabic simple">
<li><p>If this code is repeated several times
it can make things more compact</p></li>
<li><p>If this code is repeated several times
it creates a central place for that logic
so that it can be changed centrally in the future</p></li>
<li><p>It hides away details that may not be relevant to the main point of the function.
It’s like a footnote in prose.</p></li>
<li><p>It gives a name to a set of operations,
using the function name as inline documentation</p></li>
<li><p>If often feels cleaner and more abstract</p></li>
</ol>
<p>We’re taught to do this in school.
Find some chunk of functionality,
abstract it away,
move on.</p>
</section>
</section>
<section id="the-case-to-avoid-indirection">
<h2>The case to avoid indirection<a class="headerlink" href="#the-case-to-avoid-indirection" title="Permalink to this headline">#</a></h2>
<p>However, there is also a cost to this behavior.
When a new reader encounters this code,
they need to jump between many function definitions in many files.
This non-linear reading process requires more mental focus
than reading linear code.</p>
<p>This indirection isn’t as much of a problem during the writing process,
the original author is focused on building up an abstraction model in their head,
and so writing this abstraction into code makes sense and feels good.
However, it’s much more of a problem when a reader is asked
to inspect and understand a piece of code quickly.
This happens in two important situations:</p>
<ol class="arabic simple">
<li><p><strong>During review</strong>, when a reviewer is asked to verify that code is
sensible before it can be merged into the main project.
That reviewer probably has about a tenth as much time to spend
as the original author does on that code.</p></li>
<li><p><strong>While debugging</strong> future issues.
This code will eventually be involved in a bug and some completely
different developer will have to glance at this code to figure out what’s going on.
They’ll have to understand some small section this code within a few minutes
to determine what is relevant.
They won’t be able to invest the time to understand the full thought process behind it,
and a web of function definitions can slow down this process considerably.</p></li>
</ol>
<p>Both review and debugging are far more often bottlenecks in modern community
code than is original development.  Because of this, I often encourage
developers to avoid abstraction, and “please inline this function definition”.</p>
</section>
<section id="but-functions-are-still-a-good-idea">
<h2>But functions are still a good idea<a class="headerlink" href="#but-functions-are-still-a-good-idea" title="Permalink to this headline">#</a></h2>
<p>Just to be clear,
there are plenty of reasons to separate complex logic into multiple functions,
particularly when there is repetition,
or when some important policy is likely to change in the future.
There is some balance to find here.</p>
<p>Mostly, I want authors to be aware that there is a human cost to indirection
that is felt more acutely by everyone reading the code except the original author.</p>
</section>
<section id="further-reading">
<h2>Further reading<a class="headerlink" href="#further-reading" title="Permalink to this headline">#</a></h2>
<p>This post extends the broad theme in the post <a class="reference external" href="https://matthewrocklin.com/blog/work/2018/01/27/write-dumb-code">Write Dumb Code</a></p>
</section>
</section>

<div class="section">
   
</div>

              </article>
              


              
              <footer class="bd-footer-article">
                  <!-- Previous / next buttons -->
<div class='prev-next-area'>
  <a class='left-prev' id="prev-link" href="../../" title="previous page">
      <i class="fas fa-angle-left"></i>
      <div class="prev-next-info">
          <p class="prev-next-subtitle">previous</p>
          <p class="prev-next-title">Writings</p>
      </div>
  </a>
  <a class='right-next' id="next-link" href="../biased-benchmarks/" title="next page">
  <div class="prev-next-info">
      <p class="prev-next-subtitle">next</p>
      <p class="prev-next-title">Biased Benchmarks</p>
  </div>
  <i class="fas fa-angle-right"></i>
  </a>
</div>
              </footer>
              
          </div>
          
      </div>
    </div>

  
  
  <!-- Scripts loaded after <body> so the DOM is not blocked -->
  <script src="../../../_static/scripts/pydata-sphinx-theme.js?digest=92025949c220c2e29695"></script>

<footer class="bd-footer"><div class="bd-footer__inner container">
  
  <div class="footer-item">
    <p class="copyright">
    &copy; Copyright 2022, Matthew Rocklin.<br>
</p>
  </div>
  
  <div class="footer-item">
    <p class="sphinx-version">
Created using <a href="http://sphinx-doc.org/">Sphinx</a> 4.5.0.<br>
</p>
  </div>
  
</div>
</footer>
  </body>
</html>